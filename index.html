<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyCast - Êô∫ËÉΩÂ§©Ê∞î</title>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }
    </style>
</head>
<body class="bg-[#0f172a] text-white min-h-screen selection:bg-blue-500 selection:text-white overflow-x-hidden">
    <div id="app" class="min-h-screen relative">
        <!-- Dynamic Background -->
        <div class="fixed inset-0 z-0 transition-all duration-1000 bg-gradient-to-br from-slate-900 via-slate-800 to-black" :class="bgClass"></div>
        <div class="fixed inset-0 z-0 opacity-30 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] brightness-100 contrast-150 mix-blend-overlay"></div>
        
        <!-- Main Container -->
        <div class="relative z-10 container mx-auto px-4 py-8 max-w-6xl min-h-screen flex flex-col">
            
            <!-- Navbar -->
            <header class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
                <div class="flex items-center gap-3 select-none">
                    <div class="w-10 h-10 bg-gradient-to-tr from-blue-500 to-purple-500 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20">
                        <span class="text-2xl">üå§Ô∏è</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold tracking-tight">SkyCast</h1>
                        <p class="text-xs text-gray-400 uppercase tracking-widest">Weather Intelligence</p>
                    </div>
                </div>
                
                <div class="relative w-full md:w-96 group">
                    <input 
                        v-model="searchQuery" 
                        @keyup.enter="handleSearch"
                        type="text" 
                        placeholder="Search City (e.g., Âåó‰∫¨, Shanghai...)" 
                        class="w-full bg-white/5 border border-white/10 rounded-full py-3.5 pl-12 pr-24 outline-none focus:bg-white/10 focus:border-blue-400/50 transition-all placeholder-gray-500 backdrop-blur-sm text-sm"
                    >
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-blue-400 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </span>
                    <button 
                        @click="handleSearch" 
                        class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-500 text-xs font-semibold px-4 py-2 rounded-full transition-all shadow-lg shadow-blue-600/30 active:scale-95"
                    >
                        ÊêúÁ¥¢
                    </button>
                </div>
            </header>

            <!-- Loading State -->
            <div v-if="loading" class="flex-1 flex flex-col items-center justify-center min-h-[50vh]">
                <div class="relative w-20 h-20">
                    <div class="absolute inset-0 border-4 border-blue-500/30 rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                </div>
                <p class="mt-6 text-blue-200 font-light tracking-wide animate-pulse">Connecting to satellite...</p>
            </div>

            <!-- Error State -->
            <div v-else-if="errorMsg" class="flex-1 flex flex-col items-center justify-center min-h-[50vh] text-center">
                <div class="w-24 h-24 bg-red-500/10 rounded-full flex items-center justify-center mb-6">
                    <span class="text-4xl">‚ö†Ô∏è</span>
                </div>
                <h3 class="text-2xl font-bold mb-2">Connection Failed</h3>
                <p class="text-gray-400 mb-8 max-w-md">{{ errorMsg }}</p>
                <button @click="fetchData('101020100')" class="px-8 py-3 bg-white/10 hover:bg-white/20 border border-white/10 rounded-full transition-all flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    Try Again
                </button>
            </div>

            <!-- Dashboard -->
            <main v-else class="grid grid-cols-1 lg:grid-cols-12 gap-6 animate-fade-in pb-12">
                
                <!-- Left Column (4 cols) -->
                <div class="lg:col-span-4 flex flex-col gap-6">
                    <!-- Hero Card -->
                    <div class="glass-panel rounded-[2rem] p-8 relative overflow-hidden group">
                        <!-- Decorative glow -->
                        <div class="absolute -top-20 -right-20 w-64 h-64 bg-blue-500/20 rounded-full blur-3xl group-hover:bg-blue-500/30 transition-all duration-700"></div>
                        
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-8">
                                <div>
                                    <h2 class="text-4xl font-bold mb-1 tracking-tight">{{ cityInfo.city }}</h2>
                                    <p class="text-blue-200/80 text-sm font-light">{{ todayDate }}</p>
                                </div>
                                <span class="px-3 py-1 bg-white/10 rounded-lg text-xs font-mono text-gray-300 backdrop-blur-md">
                                    {{ cityInfo.updateTime }} UPDATED
                                </span>
                            </div>

                            <div class="flex flex-col items-center py-4">
                                <div class="text-[8rem] leading-none font-bold tracking-tighter bg-gradient-to-b from-white to-white/40 bg-clip-text text-transparent select-none">
                                    {{ data.wendu }}¬∞
                                </div>
                                <div class="text-2xl font-medium mt-2 flex items-center gap-3">
                                    <span>{{ getWeatherIcon(data.forecast[0].type) }}</span>
                                    <span>{{ data.forecast[0].type }}</span>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mt-8 pt-8 border-t border-white/10">
                                <div class="text-center">
                                    <p class="text-xs text-gray-400 uppercase mb-1">High</p>
                                    <p class="text-xl font-semibold">{{ data.forecast[0].highNum }}¬∞</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-gray-400 uppercase mb-1">Low</p>
                                    <p class="text-xl font-semibold">{{ data.forecast[0].lowNum }}¬∞</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AQI Card -->
                    <div class="glass-panel rounded-[2rem] p-6 flex items-center justify-between relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-green-500/10 to-transparent opacity-50" v-if="data.forecast[0].aqi <= 50"></div>
                        <div class="relative z-10 flex flex-col">
                            <span class="text-xs text-gray-400 uppercase tracking-wider mb-1">Air Quality</span>
                            <span class="text-2xl font-bold">{{ data.quality }}</span>
                        </div>
                        <div class="relative z-10 w-16 h-16 rounded-full border-4 flex items-center justify-center text-lg font-bold"
                             :class="getAqiColor(data.forecast[0].aqi)">
                            {{ data.forecast[0].aqi }}
                        </div>
                    </div>
                </div>

                <!-- Right Column (8 cols) -->
                <div class="lg:col-span-8 flex flex-col gap-6">
                    
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="glass-card rounded-2xl p-5 flex flex-col items-center justify-center aspect-[4/3] group hover:bg-white/10 cursor-default">
                            <span class="text-3xl mb-3 group-hover:scale-110 transition-transform duration-300">üíß</span>
                            <span class="text-xs text-gray-400 uppercase tracking-wider mb-1">Humidity</span>
                            <span class="text-lg font-bold">{{ data.shidu }}</span>
                        </div>
                        <div class="glass-card rounded-2xl p-5 flex flex-col items-center justify-center aspect-[4/3] group hover:bg-white/10 cursor-default">
                            <span class="text-3xl mb-3 group-hover:scale-110 transition-transform duration-300">üå¨Ô∏è</span>
                            <span class="text-xs text-gray-400 uppercase tracking-wider mb-1">Wind</span>
                            <span class="text-lg font-bold">{{ data.forecast[0].fl }}</span>
                        </div>
                        <div class="glass-card rounded-2xl p-5 flex flex-col items-center justify-center aspect-[4/3] group hover:bg-white/10 cursor-default">
                            <span class="text-3xl mb-3 group-hover:scale-110 transition-transform duration-300">üß≠</span>
                            <span class="text-xs text-gray-400 uppercase tracking-wider mb-1">Direction</span>
                            <span class="text-lg font-bold">{{ data.forecast[0].fx }}</span>
                        </div>
                        <div class="glass-card rounded-2xl p-5 flex flex-col items-center justify-center aspect-[4/3] group hover:bg-white/10 cursor-default">
                            <span class="text-3xl mb-3 group-hover:scale-110 transition-transform duration-300">üåÖ</span>
                            <span class="text-xs text-gray-400 uppercase tracking-wider mb-1">Sunrise</span>
                            <span class="text-lg font-bold">{{ data.forecast[0].sunrise }}</span>
                        </div>
                    </div>

                    <!-- Chart Section -->
                    <div class="glass-panel rounded-[2rem] p-6 flex-1 flex flex-col">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold flex items-center gap-2">
                                <span class="w-1.5 h-6 bg-blue-500 rounded-full"></span>
                                15-Day Trend
                            </h3>
                        </div>
                        <div id="chart-container" class="w-full flex-1 min-h-[250px]"></div>
                    </div>

                    <!-- Forecast List (Horizontal) -->
                    <div class="glass-panel rounded-[2rem] p-6">
                         <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                            <span class="w-1.5 h-6 bg-purple-500 rounded-full"></span>
                            Next 5 Days
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <div v-for="(day, index) in data.forecast.slice(1, 6)" :key="index" 
                                 class="glass-card rounded-2xl p-4 flex flex-col items-center justify-center text-center hover:bg-white/10 transition-colors">
                                <p class="text-xs text-gray-400 mb-1">{{ day.week }}</p>
                                <p class="text-xs font-medium mb-3">{{ day.ymd.slice(5) }}</p>
                                <div class="text-3xl mb-3">{{ getWeatherIcon(day.type) }}</div>
                                <p class="text-sm font-medium mb-1">{{ day.type }}</p>
                                <div class="flex items-center gap-2 text-sm mt-2">
                                    <span class="text-orange-300 font-bold">{{ day.highNum }}¬∞</span>
                                    <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
                                    <span class="text-blue-300">{{ day.lowNum }}¬∞</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </main>

            <footer class="mt-auto py-6 text-center">
                 <p class="text-xs text-gray-600">
                    Built with <span class="text-blue-500">Vue 3</span> & <span class="text-teal-500">Tailwind</span> ‚Ä¢ Weather Data by ItBoy
                </p>
            </footer>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, nextTick, computed } = Vue;

        createApp({
            setup() {
                const loading = ref(true);
                const errorMsg = ref('');
                const cityInfo = ref({});
                const data = ref({});
                const searchQuery = ref('');

                // ÂüéÂ∏Ç‰ª£Á†ÅÊò†Â∞Ñ
                const cityMap = {
                    'Âåó‰∫¨': '101010100', '‰∏äÊµ∑': '101020100', 'ÂπøÂ∑û': '101280101', 'Ê∑±Âú≥': '101280601',
                    'ÊàêÈÉΩ': '101270101', 'Êù≠Â∑û': '101210101', 'Âçó‰∫¨': '101190101', 'Ê≠¶Ê±â': '101200101',
                    'Ë•øÂÆâ': '101110101', 'ÈáçÂ∫Ü': '101040100', 'Â§©Ê¥•': '101030100', 'ËãèÂ∑û': '101190401',
                    'ÈÉëÂ∑û': '101180101', 'ÈïøÊ≤ô': '101250101', '‰∏úËéû': '101281601', 'Ê≤àÈò≥': '101070101',
                    'ÈùíÂ≤õ': '101120201', 'ÂêàËÇ•': '101220101', '‰ΩõÂ±±': '101280800'
                };

                const todayDate = computed(() => {
                    const date = new Date();
                    return date.toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                });

                const bgClass = computed(() => {
                    if (!data.value.forecast) return 'from-slate-900 to-black';
                    const type = data.value.forecast[0].type;
                    if (type.includes('Èõ®')) return 'from-slate-800 via-gray-900 to-black';
                    if (type.includes('Êô¥')) return 'from-blue-600 via-blue-800 to-slate-900';
                    if (type.includes('Â§ö‰∫ë') || type.includes('Èò¥')) return 'from-indigo-900 via-slate-800 to-black';
                    return 'from-slate-900 via-slate-800 to-black';
                });

                const getWeatherIcon = (type) => {
                    if (!type) return 'üå§Ô∏è';
                    if (type.includes('Êô¥')) return '‚òÄÔ∏è';
                    if (type.includes('Â§ö‰∫ë')) return '‚õÖ';
                    if (type.includes('Èò¥')) return '‚òÅÔ∏è';
                    if (type.includes('Èõ®')) return 'üåßÔ∏è';
                    if (type.includes('Èõ™')) return '‚ùÑÔ∏è';
                    if (type.includes('Èõ∑')) return '‚õàÔ∏è';
                    if (type.includes('Èõæ')) return 'üå´Ô∏è';
                    return 'üå§Ô∏è';
                };

                const getAqiColor = (aqi) => {
                    if (aqi <= 50) return 'border-green-500 text-green-400';
                    if (aqi <= 100) return 'border-yellow-500 text-yellow-400';
                    if (aqi <= 150) return 'border-orange-500 text-orange-400';
                    return 'border-red-500 text-red-400';
                };

                const initChart = (forecast) => {
                    const chartDom = document.getElementById('chart-container');
                    if(!chartDom) return;
                    
                    const chart = echarts.init(chartDom);
                    const option = {
                        grid: { top: 30, bottom: 20, left: 0, right: 0, containLabel: false },
                        xAxis: {
                            type: 'category',
                            data: forecast.map(d => d.ymd.substring(8, 10)),
                            show: false
                        },
                        yAxis: { type: 'value', show: false, min: 'dataMin', max: 'dataMax' },
                        tooltip: { 
                            trigger: 'axis', 
                            backgroundColor: 'rgba(0,0,0,0.8)', 
                            borderWidth: 0, 
                            textStyle: { color: '#fff' },
                            formatter: '{b}Êó• <br/> {a0}: {c0}¬∞ <br/> {a1}: {c1}¬∞'
                        },
                        series: [
                            {
                                name: 'High',
                                type: 'line',
                                smooth: true,
                                data: forecast.map(d => d.highNum),
                                itemStyle: { color: '#fbbf24' },
                                lineStyle: { width: 4, shadowColor: 'rgba(251,191,36,0.5)', shadowBlur: 10 },
                                symbolSize: 6,
                                label: { show: true, position: 'top', color: '#fff', fontSize: 12, formatter: '{c}¬∞' },
                                areaStyle: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                        { offset: 0, color: 'rgba(251,191,36,0.3)' },
                                        { offset: 1, color: 'rgba(251,191,36,0)' }
                                    ])
                                }
                            },
                            {
                                name: 'Low',
                                type: 'line',
                                smooth: true,
                                data: forecast.map(d => d.lowNum),
                                itemStyle: { color: '#60a5fa' },
                                lineStyle: { width: 4, type: 'dashed', opacity: 0.7 },
                                symbolSize: 6,
                                label: { show: true, position: 'bottom', color: 'rgba(255,255,255,0.7)', fontSize: 12, formatter: '{c}¬∞' }
                            }
                        ]
                    };
                    chart.setOption(option);
                    window.addEventListener('resize', () => chart.resize());
                };

                const fetchData = async (cityCode = '101020100') => {
                    loading.value = true;
                    errorMsg.value = '';
                    
                    const targetUrl = `http://t.weather.itboy.net/api/weather/city/${cityCode}`;
                    
                    // ÂÆö‰πâÂ∞ùËØïÁ≠ñÁï•ÔºöÁõ¥Êé•ËØ∑Ê±Ç -> ÂÖ¨ÂÖ±‰ª£ÁêÜ1 -> ÂÖ¨ÂÖ±‰ª£ÁêÜ2
                    const strategies = [
                        { name: 'Direct', url: targetUrl },
                        { name: 'Proxy 1', url: `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(targetUrl)}` },
                        { name: 'Proxy 2', url: `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}` }
                    ];

                    let lastError;

                    for (const strategy of strategies) {
                        try {
                            console.log(`Â∞ùËØïÈÄöËøá [${strategy.name}] Ëé∑ÂèñÊï∞ÊçÆ...`);
                            const res = await fetch(strategy.url);
                            
                            if (!res.ok) {
                                throw new Error(`Status ${res.status}`);
                            }
                            
                            const json = await res.json();
                            
                            // È™åËØÅÊï∞ÊçÆÊúâÊïàÊÄß
                            if (json.status !== 200 || !json.data) {
                                throw new Error(json.message || "Êï∞ÊçÆÊó†Êïà");
                            }

                            // Êï∞ÊçÆËé∑ÂèñÊàêÂäüÔºåÂ§ÑÁêÜÊï∞ÊçÆ
                            json.data.forecast = json.data.forecast.map(day => ({
                                ...day,
                                highNum: parseInt(day.high.replace(/[^0-9.-]/g, '')),
                                lowNum: parseInt(day.low.replace(/[^0-9.-]/g, '')),
                                shortDate: day.ymd.substring(5).replace('-', '/')
                            }));

                            cityInfo.value = json.cityInfo;
                            data.value = json.data;
                            loading.value = false;

                            await nextTick();
                            initChart(json.data.forecast);
                            return; // ÊàêÂäüÂêéÁõ¥Êé•ÈÄÄÂá∫ÂáΩÊï∞

                        } catch (err) {
                            console.warn(`[${strategy.name}] Â§±Ë¥•:`, err);
                            lastError = err;
                            // ÁªßÁª≠Â∞ùËØï‰∏ã‰∏Ä‰∏™Á≠ñÁï•
                        }
                    }

                    // Â¶ÇÊûúÊâÄÊúâÁ≠ñÁï•ÈÉΩÂ§±Ë¥•
                    console.error("ÊâÄÊúâÂ∞ùËØïÂùáÂ§±Ë¥•", lastError);
                    errorMsg.value = `Êó†Ê≥ïÂä†ËΩΩÊï∞ÊçÆ (${lastError.message})„ÄÇÂèØËÉΩÊòØÁî±‰∫éË∑®ÂüüÈôêÂà∂(CORS)ÊàñÁΩëÁªúËøûÊé•ÈóÆÈ¢ò„ÄÇÂª∫ËÆÆÂÆâË£Ö 'Allow CORS' ÊµèËßàÂô®Êèí‰ª∂„ÄÇ`;
                    loading.value = false;
                };

                const handleSearch = () => {
                    const query = searchQuery.value.trim();
                    if (!query) return;

                    const city = Object.keys(cityMap).find(k => query.includes(k));
                    
                    if (city) {
                        fetchData(cityMap[city]);
                    } else {
                        alert("ÊöÇ‰∏çÊîØÊåÅËØ•ÂüéÂ∏ÇÔºåËØ∑Â∞ùËØï: " + Object.keys(cityMap).slice(0,5).join(', ') + "...");
                    }
                };

                onMounted(() => fetchData());

                return { 
                    loading, errorMsg, cityInfo, data, searchQuery, 
                    todayDate, bgClass,
                    getWeatherIcon, getAqiColor, handleSearch, fetchData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
